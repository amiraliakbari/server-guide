---
layout: page
title: Media Folder
---

# پوشه media

معمولا در پروژه‌های وب لازم است که کاربران بتوانند فایل هایی مخصوص خود داشته باشند.
ساده‌ترین مثال از این گونه کاربرد، فراهم کردن امکان آپلود تصویر برای کاربران یک سامانه است.
الگویی رایج برای مدیریت این فایل‌ها، داشتن یک پوشه است که تمام فایل‌های بارگزاری شده یا تولید شده مخصوص
کاربران در آن قرار می‌گیرد، که نام این پوشه را غالبا media گذاشته و در پوشه اصلی پروژه قرار می‌دهند.

پوشه media باید توسط کاربر یا گروه وب سرور قابل نوشتن باشد، به همین دلیل دسترسی آن `755 www-data:www-data`
تعیین می‌شود. به این صورت، امکان ایجاد فایل در آن پوشه و پوشه‌های زیر مجموعه‌اش برای وب سرور وجود خواهد داشت.

**توضیح:** وب سرور، نرم‌افزاری که به درخواست‌های وب (http) کاربران پاسخ می‌دهد، با این که در ابتدا به عنوان
کاربر root اجرا می‌شود، ولی پس از شروع کار و bind شدن به پورت‌های خاص لازم (مثلا 80 و 443)، کار را در قالب کاربری غیر ادمین 
ادامه می‌دهد تا در صورت وجود ایراد در کد و نفوذ از این طریق به سیستم، تبعات امنیتی کمتری داشته باشد. نام کاربری و گروه
مورد استفاده توسط وب سرور آپاچی، `www-data` (در توزیع‌هایی مانند ubuntu و debian) یا `www` است.

**ملاحظه امنیتی:** در صورتی که روی یک سرور چندین سایت میزبانی شوند، در تنظیمات پیش‌فرض تمام این سایت‌ها توسط کاربر
وب سرور قابل خواندن و برای بعضی پوشه‌ها حتی قابل نوشتن هستند، در نتیجه در صورت نفوذ به یکی از سایت‌های میزبانی شده
یا قصد صاحب آن سایت برای اخلال در کار سایر سایت‌های روی سرور، امکان خواندن و حتی نوشتن فایل‌های سایت‌های دیگر وجود
دارد. یک راه حل برای این موضوع، اجرای وب سرور برای هر سایت میزبانی شده با یک کاربر مجزا است، که مثلا در آپاچی این
کار با استفاده از `npm-itk` ممکن است. البته این راه حل مشکلاتی نیز دارد که در نتیجه باید با دقت و پس از بررسی جوانب مختلف 
آن مورد بهره‌برداری قرار بگیرد تا مشکل امنیتی جدی‌تری ایجاد نکند.

<br/>

-------------------
<br/>

## استقرار

برای استقرار بدون دردسر روی سرور، پیشنهاد می‌شود که با استفاده از یک پوشه media همه فایل‌های مخصوص کاربر
را در یکجا نگهداری کنید. همچنین احتمالا نیاز است که فایل‌های پوشه media را با چندین زیر پوشه دسته‌بندی کنید، مثلا یک پوشه
برای عکس‌های آپلود شده کاربران، یک پوشه برای thumbnailهای تولید شده از روی عکس‌ها، یک پوشه برای فایل‌های آپلودی و ...
برای این که دقیقا این زیر پوشه‌ها معلوم باشند، پیشنهاد می‌شود که تمامی این پوشه‌ها در مخزن مدیریت نسخه پروژه موجود باشند،
تا در صورت نیاز به clone پروژه در یک رایانه دیگر، این زیرپوشه‌ها آن‌جا هم موجود باشند تا از بروز استثنا در کد جلوگیری شود.
البته تمامی فایل‌های موجود در پوشه media نیازی به ثبت شدن در سیستم مدیریت نسخه ندارند، چرا که کاملا محلی هر رایانه‌ای
هستند، و می‌توان آن‌ها را به تمامی در لیست ignore قرار داد.

**ملاحظه:** در سیستم مدیریت نسخه گیت، از اضافه کردن پوشه به مخزن پشتیبانی نمی‌شود چرا که واحد ذخیره‌سازی در آن فایل
است، بنابراین برای اضافه کردن یک پوشه به مخزن گیت، از تکنیک ساختن یک فایل واسط در آن و اضافه کردن آن فایل به مخزن استفاده
می‌شود. یک پیشنهاد مناسب برای این فایل، یک فایل `gitignore.` است، که واضح هم هست که مربوط به گیت است و نقش محتوایی
در پروژه ندارد. در پوشه media، بهترین راه داشتن یک فایل `gitignore.` در هر یک از زیرپوشه‌های media (یا در خود media در صورت
نداشتن هیچ زیر پوشه‌ای) است، که متن آن یک * باشد، که برای گیت به معنی نادیده گرفتن تمام فایل‌های آن پوشه است.

**راهکار:** یک فایل `gitignore.` دارای * به معنی نادیده گرفتن تمام فایل‌های آن پوشه توسط گیت است، از جمله خود آن فایل!
بنابراین این فایل را نمی‌توان مستقیما به مخزن اضافه و کامیت کرد. برای کامیت آن، یا می‌توان ابتدا فایل را خالی ایجاد کرد، آن را به
مخزن اضافه کرد (`git add`) و سپس داخل آن * نوشت و در نهایت کامیت انجام داد. راه دیگر، استفاده از دستور `git add -f` 
است که به گیت فرمان می‌دهد با وجود ignore شده بودن فایل، آن را به مخزن اضافه کند.

